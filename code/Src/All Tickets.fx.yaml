"'All Tickets' As screen":
    OnHidden: |-
        =//Reset(TextInput1_9);
        Reset(compSearchTickets_1);
        Set(SearchAllTicketsQuery,
             ""
        );
        Reset(Gallery4_2);
    OnVisible: |
        =//Reset(compFilterMenu_6);
        Reset(compFilterTicketsMenu_1);
        UpdateContext({varPageNumber:1})

    MainAllTickets As groupContainer.horizontalAutoLayoutContainer:
        Height: =Parent.Height
        LayoutAlignItems: =LayoutAlignItems.Stretch
        LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
        LayoutMode: =LayoutMode.Auto
        Width: =Parent.Width
        ZIndex: =1

        VerticalLayoutAllTickets As groupContainer.verticalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            Height: =Parent.Height
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutDirection: =LayoutDirection.Vertical
            LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            Width: =Parent.Width
            ZIndex: =2

            AllTicketsHeaderFinal As groupContainer.verticalAutoLayoutContainer:
                FillPortions: =0
                Height: |-
                    =130
                    //Parent.Height/11
                LayoutAlignItems: =LayoutAlignItems.Center
                LayoutDirection: =LayoutDirection.Vertical
                LayoutJustifyContent: =LayoutJustifyContent.Center
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Width: =Parent.Width
                ZIndex: =1

                compWebHeader_13 As compWebHeader:
                    CompScreenSize: ='All Tickets'.Size
                    LayoutMinHeight: =Parent.Height
                    LayoutMinWidth: =640
                    ZIndex: =1

                TagName_2 As label:
                    Align: =Align.Center
                    Color: =RGBA(255, 255, 255, 1)
                    Fill: =ColorScheme.primary
                    FillPortions: =1
                    Height: =Parent.Height
                    Size: =If('All Tickets'.Size= 1 , titleText.mobileSize, titleText.desktopSize)
                    Text: ="All Tickets"
                    Width: =Parent.Width
                    X: =(Parent.Width - Self.Width)/2
                    ZIndex: =2

            SearchTickets As groupContainer.horizontalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.SetByContainer
                FillPortions: =0
                Height: |-
                    =//Parent.Height
                    //compWebHeader_13.Height
                    Parent.Height/11
                LayoutAlignItems: =LayoutAlignItems.Stretch
                LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                LayoutMinHeight: =//compWebHeader_28.Height
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Width: =Parent.Width
                ZIndex: =3

                AddTagsBar_2 As groupContainer.horizontalAutoLayoutContainer:
                    AlignInContainer: =AlignInContainer.SetByContainer
                    Height: =Parent.Height
                    LayoutAlignItems: =LayoutAlignItems.Center
                    LayoutJustifyContent: =LayoutJustifyContent.Center
                    LayoutMinHeight: =Parent.Height
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    Width: =Parent.Width
                    ZIndex: =1

                    compSearchTickets_1 As compSearchTickets:
                        LayoutMinHeight: =640
                        LayoutMinWidth: =640
                        OnReset: |-
                            =Set(
                                SearchQuery,
                                ""
                            );
                            Reset(searchBox_1);
                            Set(
                                varSearchText,
                                ""
                            );
                            compSearchTickets_1.CloseSearch();
                            
                            // Used with SearchFilterTicktesSPListV2 (passes string to search, status, tag, user id, tickets selection, date to get tickets starting from to power automate and return the filtered results)
                            ClearCollect(
                                colTickets,
                                ForAll(
                                    Table(
                                        ParseJSON(
                                            SearchFilterTicketsSPListV2.Run(
                                            If(
                                                IsBlank(SearchQuery),
                                                "___",
                                                SearchQuery
                                                ), StatusChoice, TagChoice, userData.id, TicketsChoice, DateAdd(Today(), -varSubtractDate, varTimeUnits)
                                            ).searchresults
                                        )
                                    ),
                                    {
                                        ID: Value(Value.ID),
                                        Title: Text(Value.title),
                                        Description: Text(Value.description),
                                        MainCategory: Value(Value.mainCategory),
                                        Category: Value(Value.category),
                                        SubCategory: Value(Value.subCategory),
                                        DateCreated: DateTimeValue(Value.dateCreated),
                                        DateClosed: DateTimeValue(Value.dateClosed),
                                        CreatorId: Value(Value.creatorId),
                                        Status: Text(Value.status),
                                        AssignedTo: Value(Value.assignedTo),
                                        LastUpdated: DateTimeValue(Value.lastUpdated),
                                        UpdatedBy: Value(Value.updatedBy),
                                        ParentId: Value(Value.parentId),
                                        LocationId: Value(Value.locationId),
                                        Tags: Text(Value.tags),
                                        AddAssignees: Text(Value.addAssignees)
                                    }
                                )
                            )
                            
                            /*ClearCollect(
                                colTickets,
                                ForAll(
                                    Table(
                                        ParseJSON(
                                            SearchFilterTicketsSPList.Run(
                                                If(
                                                    IsBlank(SearchQuery),
                                                    "___",
                                                    SearchQuery
                                                ), StatusChoice, TagChoice
                                            ).searchresults
                                        )
                                    ),
                                    {
                                        ID: Value(Value.ID),
                                        Title: Text(Value.title),
                                        Description: Text(Value.description),
                                        MainCategory: Value(Value.mainCategory),
                                        DateCreated: DateValue(Value.dateCreated),
                                        CreatorId: Value(Value.creatorId),
                                        Status: Text(Value.status),
                                        AssignedTo: Value(Value.assignedTo),
                                        LastUpdated: DateValue(Value.lastUpdated),
                                        LocationId: Value(Value.locationId),
                                        Tags: Text(Value.tags),
                                        AddAssignees: Text(Value.addAssignees)
                                    }
                                )
                            )*/

            MainAllTicketLayout_1 As groupContainer.horizontalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.Center
                Height: =Parent.Height
                LayoutMinHeight: =0
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                PaddingBottom: =25
                Width: =Parent.Width/1.06
                ZIndex: =5

                MainContainer As groupContainer.verticalAutoLayoutContainer:
                    Height: =Parent.Height
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutMinHeight: =0
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    Width: =Parent.Width
                    ZIndex: =1

                    ColAllTicket As groupContainer.manualLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =Parent.Height/11
                        LayoutMinHeight: =//100
                        LayoutMinWidth: =250
                        Width: =Parent.Width
                        ZIndex: =1

                        MainColAllTicket As groupContainer.horizontalAutoLayoutContainer:
                            Height: |-
                                =//SearchTickets.Height/1.7
                                Parent.Height
                            LayoutAlignItems: =LayoutAlignItems.Stretch
                            LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                            LayoutMode: =LayoutMode.Auto
                            Width: =Parent.Width
                            Y: |
                                =
                            ZIndex: =2

                            id As label:
                                Align: =Align.Center
                                Color: =ColorScheme.screenBackground
                                Fill: =ColorScheme.primary
                                Size: =If ('All Tickets'.Size =1, 10, 13)
                                Text: ="ID"
                                Width: =Parent.Width/6
                                X: =608
                                ZIndex: =1

                            status As label:
                                Align: =Align.Center
                                Color: =ColorScheme.screenBackground
                                Fill: =ColorScheme.primary
                                Size: =If ('All Tickets'.Size =1, 10, 13)
                                Text: ="Status"
                                Width: =Parent.Width/6
                                X: =608
                                ZIndex: =2

                            title As label:
                                Align: =Align.Center
                                Color: =ColorScheme.screenBackground
                                Fill: =ColorScheme.primary
                                Size: =If ('All Tickets'.Size =1, 10, 13)
                                Text: ="Title"
                                Width: =Parent.Width/6
                                X: =608
                                ZIndex: =3

                            date_created As label:
                                Align: =Align.Center
                                Color: =ColorScheme.screenBackground
                                Fill: =ColorScheme.primary
                                Size: =If ('All Tickets'.Size =1, 10, 13)
                                Text: ="Date Created"
                                Width: =Parent.Width/6
                                X: =608
                                ZIndex: =5

                            main_category As label:
                                Align: =Align.Center
                                Color: =ColorScheme.screenBackground
                                Fill: =ColorScheme.primary
                                Size: =If ('All Tickets'.Size =1, 10, 13)
                                Text: ="Main Category"
                                Width: =Parent.Width/6
                                X: =608
                                ZIndex: =7

                            assignee As label:
                                Align: =Align.Center
                                Color: =ColorScheme.screenBackground
                                Fill: =ColorScheme.primary
                                Text: ="Assignee"
                                Width: =Parent.Width/6
                                ZIndex: =8

                    Gallery4_2 As gallery.galleryVertical:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        BorderThickness: =4
                        DelayItemLoading: =true
                        FillPortions: =0
                        Height: =Parent.Height/1.25
                        Items: |-
                            =//Tickets
                            
                            //Sort(Filter(colTickets,Status = "open"),DateCreated,SortOrder.Descending)
                            
                            //Sort(colAllTickets, DateCreated, SortOrder.Descending)
                            /*If(varPageNumber=1, FirstN(Sort(Tickets,dateCreated,SortOrder.Descending),10*varPageNumber), LastN(FirstN(Sort(Tickets,dateCreated,SortOrder.Descending),10*varPageNumber),10*1))*/
                            
                            If(varPageNumber=1, FirstN(Sort(colAllTickets,DateCreated,SortOrder.Descending),10*varPageNumber), LastN(FirstN(Sort(colAllTickets,DateCreated,SortOrder.Descending),10*varPageNumber),10*1))
                        Layout: =Layout.Vertical
                        LayoutMinHeight: =287
                        LayoutMinWidth: =320
                        LoadingSpinner: =LoadingSpinner.Data
                        TemplatePadding: =0
                        TemplateSize: |-
                            =//If(Self.Layout = Layout.Horizontal, Min(280, Self.Width - 60), Min(280, Self.Height - 60))
                            Parent.Height/10
                        Width: =Parent.Width
                        Y: =MainColAllTicket.Y
                        ZIndex: =3

                        alltassignedto As label:
                            Align: =Align.Center
                            BorderThickness: =2
                            Height: =Parent.TemplateHeight
                            OnSelect: =Select(Parent)
                            Text: =If(ThisItem.AssignedTo = 0 || IsBlank(ThisItem.AssignedTo), "Unassigned", LookUp(Users_1, ID = ThisItem.AssignedTo, fullName))
                            Width: =assignee.Width
                            X: =assignee.X
                            ZIndex: =1

                        alltmaincategory As label:
                            Align: =Align.Center
                            BorderThickness: =2
                            Height: =Parent.TemplateHeight
                            OnSelect: =Select(Parent)
                            Text: |-
                                =//LookUp(Category_1, ID= ThisItem.mainCategory, name)
                                If(ThisItem.MainCategory = 0 || IsBlank(ThisItem.MainCategory), "No Main Category", LookUp(Category_1, ID = ThisItem.MainCategory, name))
                            Width: =main_category.Width
                            X: =main_category.X
                            ZIndex: =2

                        alltdatecreated As label:
                            Align: =Align.Center
                            BorderThickness: =2
                            Height: =Parent.TemplateHeight
                            OnSelect: =Select(Parent)
                            Text: |-
                                =//DateValue(ThisItem.dateCreated)
                                ThisItem.DateCreated
                            Width: =date_created.Width
                            X: =date_created.X
                            ZIndex: =3

                        allttitle As label:
                            Align: =Align.Center
                            BorderThickness: =2
                            Height: =Parent.TemplateHeight
                            OnSelect: =Select(Parent)
                            Text: =ThisItem.Title
                            Width: =title.Width
                            X: =title.X
                            ZIndex: =4

                        alltstatus As label:
                            Align: =Align.Center
                            BorderThickness: =2
                            Color: =ColorScheme.screenBackground
                            Fill: |-
                                =//Switch(Label40_1.Text,"open", ColorScheme.offColor, "closed", ColorScheme.orange,ColorScheme.screenBackground)
                                ColorScheme.secondary
                            Height: =Parent.TemplateHeight
                            OnSelect: =Select(Parent)
                            Text: =ThisItem.Status
                            Width: =status.Width
                            X: =status.X
                            ZIndex: =5

                        alltid As label:
                            Align: =Align.Center
                            BorderThickness: =2
                            Height: =Parent.TemplateHeight
                            OnSelect: =Select(Parent)
                            Text: =ThisItem.ID
                            Width: =id.Width
                            X: =id.X
                            ZIndex: =6

                        hoverTicket As label:
                            Align: =Align.Center
                            Color: =Color.Transparent
                            Fill: =Color.Transparent
                            Height: =Parent.TemplateHeight
                            HoverBorderColor: =RGBA(53, 89, 137, 0)
                            HoverFill: =RGBA(53,89,137, 0.35)
                            OnSelect: |-
                                =//Select(Parent)
                                /*Navigate('Single Ticket Info', ScreenTransition.Fade, {ticketInfo: {Title: ThisItem.title,Description:ThisItem.description,ID:ThisItem.ID,CreatorId:ThisItem.creatorId,DateCreated: ThisItem.dateCreated,MainCategory: ThisItem.mainCategory,AddAssignees:ThisItem.addAssignees,Status: ThisItem.status}})*/
                                
                                Navigate('Single Ticket Info', ScreenTransition.Fade, {ticketInfo:ThisItem})
                            Text: =""
                            Width: =Parent.TemplateWidth
                            X: |
                                =0
                            ZIndex: =7

                    Container7 As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =Parent.Height/9
                        LayoutMinHeight: |+
                            =0
                            
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Width: =Parent.Width
                        ZIndex: =4

                        Container8 As groupContainer.manualLayoutContainer:
                            FillPortions: =0
                            Height: =Parent.Height
                            LayoutMinHeight: =0
                            LayoutMinWidth: |
                                =0
                            Width: =Parent.Width
                            ZIndex: =1

                            Icon3 As icon.ArrowRight:
                                DisplayMode: =If(10*varPageNumber<CountRows(colAllTickets), DisplayMode.Edit,DisplayMode.Disabled)
                                Height: =Label1.Height
                                Icon: =Icon.ArrowRight
                                OnSelect: |-
                                    =UpdateContext({varPageNumber:varPageNumber+1})
                                X: =(Label1.X+Label1.Width)
                                Y: =Parent.Height/4
                                ZIndex: =1

                            Label1 As label:
                                Align: =Align.Center
                                Text: =varPageNumber & " of " & RoundUp(CountRows(colAllTickets)/10,0)
                                X: =(Parent.Width/2)-Self.Width/2
                                Y: =Parent.Height/4
                                ZIndex: =2

                            Icon5 As icon.ArrowLeft:
                                DisplayMode: |
                                    =If(varPageNumber<=1,DisplayMode.Disabled,DisplayMode.Edit)
                                Height: =Label1.Height
                                Icon: =Icon.ArrowLeft
                                OnSelect: |-
                                    =UpdateContext({varPageNumber:varPageNumber-1})
                                X: =Label1.X - Self.Width
                                Y: =Parent.Height/4
                                ZIndex: =3

            AllTicketsMobileNav_1 As groupContainer.verticalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.SetByContainer
                FillPortions: =0
                Height: =compMobileMenu_20.Height
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Visible: =If('All Tickets'.Size = 1, true, false)
                Width: =Parent.Width
                ZIndex: =6

            AllTicketsFooter As groupContainer.verticalAutoLayoutContainer:
                Fill: =RGBA(255,255,255, 1)
                FillPortions: =0
                Height: =Parent.Height/8
                LayoutAlignItems: =LayoutAlignItems.Center
                LayoutDirection: =LayoutDirection.Vertical
                LayoutJustifyContent: =LayoutJustifyContent.Center
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Visible: |
                    =If('All Tickets'.Size = 1,true,false)
                Width: =Parent.Width
                ZIndex: =7

                compMobileMenu_7 As compMobileMenu:
                    Height: =Parent.Height
                    LayoutMinHeight: =640
                    LayoutMinWidth: =640
                    Width: =Parent.Width

    Icon1_32 As icon.BackArrow:
        Color: =ColorScheme.secondary
        Height: =49
        Icon: =Icon.BackArrow
        OnSelect: =Navigate('Admin Manager', ScreenTransition.Fade)//Back(ScreenTransition.Fade)
        Width: =49
        X: =15
        Y: =SingleTicketInfo_Title.Y
        ZIndex: =2

    compWebMenu_9 As compWebMenu:
        Visible: ='All Tickets'.Size > 1
        ZIndex: =3

    compFilterTicketsMenu_1 As compFilterTicketsMenu:
        CheckAdmin: |-
            =//is_admin
            
            //If(App.ActiveScreen.Name = "MyTickets", is_admin, true)
            
            !(App.ActiveScreen.Name = "AllTickets") || (App.ActiveScreen.Name = "AllTickets" && (userData.role = "admin" || userData.role = "tech"))
        FontSize: |-
            =//If(App.Height > 560, 18, 13)
            
            If(App.Height - compFilterTicketsMenu_1.HeightOffset > 340, 16, 13)
        Height: =If(compFilterTicketsMenu_1.FilterVisible, compFilterTicketsMenu_1.NewHeight, compFilterTicketsMenu_1.FilterIconSize)
        IconSize: |-
            =//If(App.Height > 560, 40, 30)
            
            If(App.Height - compFilterTicketsMenu_1.HeightOffset > 560, 40, 30)
        NewHeight: |-
            =//If(compFilterMenu.CheckAdmin&&App.ActiveScreen.Name="MyTickets",If(App.Height>560,400,320),!compFilterMenu.CheckAdmin&&App.ActiveScreen.Name="MyTickets",150,If(App.Height>560,420,320))
            
            If(
                compFilterTicketsMenu_1.CheckAdmin && App.ActiveScreen.Name = "AllTickets",
                If(
                    App.Height - compFilterTicketsMenu_1.HeightOffset > 560,
                    400,
                    320
                ),
                !compFilterTicketsMenu_1.CheckAdmin && App.ActiveScreen.Name = "AllTickets",
                150,
                If(
                    App.Height - compFilterTicketsMenu_1.HeightOffset > 560,
                    420,
                    320
                )
            )
        OnReset: |-
            =Reset(CheckboxAssignment);
            Reset(RadioTickets);
            Reset(DropdownStatus);
            Reset(DropdownTag);
            Set(
                TicketsChoice,
                If(
                    userData.role = "admin" || userData.role = "tech",
                    "My Assigned",
                    "My Tickets"
                )
            );
            Set(
                StatusChoice,
                "open"
            );
            Set(
                TagChoice,
                "None"
            );
            Set(
                AssignmentChoice,
                true
            );
            compFilterTicketsMenu_1.CloseFilter();
            If(
                !(App.ActiveScreen.Name = "MyTickets"),
                // Used with RecentTicketsSPListV2
                ClearCollect(
                    colAllTickets,
                    ForAll(
                        Table(
                            ParseJSON(
                                RecentTicketsSPListV2.Run(
                                    DateAdd(
                                        Today(),
                                        -1,
                                        TimeUnit.Months
                                    ),
                                    If(
                                        IsBlank(SearchAllTicketsQuery),
                                        "___",
                                        SearchAllTicketsQuery
                                    ),
                                    StatusChoice,
                                    AssignmentChoice
                                ).searchresults
                            )
                        ),
                        {
                            ID: Value(Value.ID),
                            Title: Text(Value.title),
                            Description: Text(Value.description),
                            MainCategory: Value(Value.mainCategory),
                            Category: Value(Value.category),
                            SubCategory: Value(Value.subCategory),
                            DateCreated: DateTimeValue(Value.dateCreated),
                            DateClosed: DateTimeValue(Value.dateClosed),
                            CreatorId: Value(Value.creatorId),
                            Status: Text(Value.status),
                            AssignedTo: Value(Value.assignedTo),
                            LastUpdated: DateTimeValue(Value.lastUpdated),
                            UpdatedBy: Value(Value.updatedBy),
                            ParentId: Value(Value.parentId),
                            LocationId: Value(Value.locationId),
                            Tags: Text(Value.tags),
                            AddAssignees: Text(Value.addAssignees)
                        }
                    )
                )
            )
        Width: |-
            =//If(compFilterMenu.FilterVisible, If(App.Height > 560, 230, 190), compFilterMenu.FilterIconSize)
            If(compFilterTicketsMenu_1.FilterVisible, If(App.Width > 600 && App.Height - compFilterTicketsMenu_1.HeightOffset > 400, 220, 185), compFilterTicketsMenu_1.FilterIconSize)
        X: |-
            =//Parent.Width/1.2
            Parent.Width - compSearchTickets_1.X/1.2
        Y: =Parent.Height/5.7
        ZIndex: =4

